# データベース設計書

## 概要

UmapicアプリのデータストアとしてAmazon DynamoDBを採用します。
サーバーレスアーキテクチャに適した、スケーラブルなNoSQLデータベースです。

## ドキュメント構成

| ファイル | 内容 |
|:---|:---|
| [dynamodb-tables.md](./dynamodb-tables.md) | DynamoDBテーブル定義 |
| [s3-storage.md](./s3-storage.md) | S3ストレージ設計 |
| [data-flow.md](./data-flow.md) | データフロー図 |

## 技術選定理由

### DynamoDB採用理由

| 観点 | 理由 |
|:---|:---|
| スケーラビリティ | ユーザー数増加に自動対応 |
| コスト | 従量課金、初期費用なし |
| 運用負荷 | マネージドサービスで運用不要 |
| レイテンシ | ミリ秒単位の高速レスポンス |
| AWS連携 | Lambda, Cognito等との親和性 |

### S3採用理由（画像保存）

| 観点 | 理由 |
|:---|:---|
| 容量 | 無制限ストレージ |
| 耐久性 | 99.999999999% (11ナイン) |
| 配信 | CloudFront連携で高速配信 |
| コスト | 安価なストレージ費用 |

## アクセスパターン

### 主要なクエリパターン

| パターン | 頻度 | 使用インデックス |
|:---|:---|:---|
| ユーザーの全記録取得 | 高 | メインテーブル (PK) |
| 訪問日順で記録取得 | 高 | GSI1_VisitDate |
| 特定の記録を取得 | 中 | メインテーブル (PK + SK) |
| 記録の作成 | 中 | メインテーブル |
| 記録の削除 | 低 | メインテーブル |

## キャパシティ設計

### 初期設定（オンデマンド）

| 設定 | 値 | 理由 |
|:---|:---|:---|
| モード | オンデマンド | トラフィック予測困難なため |
| RCU | 自動スケール | - |
| WCU | 自動スケール | - |

### 将来的な検討

- 利用パターン安定後、プロビジョンドに変更検討
- リザーブドキャパシティでコスト最適化
