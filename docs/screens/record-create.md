# SCR-003: 記録作成画面

## 基本情報

| 項目 | 内容 |
|:---|:---|
| 画面ID | SCR-003 |
| 画面名 | 記録作成 |
| 対応機能 | F-01 新規記録の作成, F-02 店舗情報の自動取得 |

## 画面レイアウト

```
┌─────────────────────────────────┐
│ [×]   新しい記録      [保存]    │
├─────────────────────────────────┤
│                                 │
│  ┌─────────────────────────┐    │
│  │                         │    │
│  │    📷 写真を追加        │    │
│  │    タップして選択        │    │
│  │                         │    │
│  └─────────────────────────┘    │
│                                 │
│  ───────── 店舗情報 ─────────   │
│                                 │
│  店舗名 *                       │
│  ┌───────────────────────────┐  │
│  │ 🔍 店舗を検索             │  │
│  └───────────────────────────┘  │
│                                 │
│  ┌─────────────────────────┐    │
│  │     [ミニマップ]        │    │
│  │       📍               │    │
│  └─────────────────────────┘    │
│                                 │
│  ───────── 訪問情報 ─────────   │
│                                 │
│  訪問日 *                       │
│  ┌───────────────────────────┐  │
│  │ 📅 2024/12/05            │  │
│  └───────────────────────────┘  │
│                                 │
│  評価 *                         │
│  ☆ ☆ ☆ ☆ ☆                    │
│                                 │
│  同行者                         │
│  ┌───────────────────────────┐  │
│  │ [友人] [+追加]            │  │
│  └───────────────────────────┘  │
│                                 │
│  メモ                           │
│  ┌───────────────────────────┐  │
│  │                           │  │
│  │ 感想を入力...              │  │
│  │                           │  │
│  └───────────────────────────┘  │
│                                 │
└─────────────────────────────────┘
```

## UI要素詳細

### ナビゲーションバー

| 要素ID | 種類 | アクション |
|:---|:---|:---|
| btn_close | Icon Button | 確認ダイアログ後、閉じる |
| btn_save | Text Button | 記録を保存 |

### 写真セクション

| 要素ID | 種類 | 説明 |
|:---|:---|:---|
| photo_picker | Image Picker | 写真選択/撮影エリア |
| photo_preview | Image Grid | 選択済み写真のプレビュー |
| btn_delete_photo | Icon Button | 写真の削除 |

### 写真選択アクションシート

```
┌─────────────────────────────────┐
│   写真を追加                    │
├─────────────────────────────────┤
│   📷 カメラで撮影               │
│   🖼️ ライブラリから選択         │
│   ─────────────────────────     │
│   キャンセル                    │
└─────────────────────────────────┘
```

### 店舗検索セクション

| 要素ID | 種類 | 説明 |
|:---|:---|:---|
| input_store_search | TextField | 店舗名検索入力 |
| map_preview | MapView | 選択位置のミニマップ |
| store_suggestions | List | 検索候補リスト |

### 店舗検索フロー

```
[検索入力] → [Google Places API] → [候補表示]
                                        │
                                        ▼
                              [候補選択]
                                        │
                                        ▼
                              [店舗名・緯度経度を自動入力]
                              [ミニマップにピン表示]
```

### 訪問情報セクション

| 要素ID | 種類 | 説明 |
|:---|:---|:---|
| input_date | DatePicker | 訪問日選択 |
| input_rating | Star Rating | 5段階評価 |
| input_companions | Tag Input | 同行者タグ |
| input_note | TextArea | メモ入力 |

### 同行者タグ入力

| 機能 | 説明 |
|:---|:---|
| 新規追加 | テキスト入力でタグ作成 |
| 候補表示 | 過去に使用したタグを候補表示 |
| 削除 | タグの×ボタンで削除 |
| プリセット | 「1人」「友人と」「家族と」「恋人と」「同僚と」 |

## バリデーション

| フィールド | ルール | エラーメッセージ |
|:---|:---|:---|
| 写真 | 任意（最大5枚） | - |
| 店舗名 | 必須 | 店舗を選択してください |
| 訪問日 | 必須、未来日不可 | 正しい日付を選択してください |
| 評価 | 必須（1-5） | 評価を選択してください |
| 同行者 | 任意 | - |
| メモ | 任意（最大1000文字） | メモは1000文字以内で入力してください |

## 状態管理

### 画面状態

| 状態 | 説明 |
|:---|:---|
| editing | 入力中 |
| searching | 店舗検索中 |
| uploading | 写真アップロード中 |
| saving | 保存処理中 |
| saved | 保存完了 |
| error | エラー発生 |

### 未保存離脱の確認

```
┌─────────────────────────────────┐
│        変更を破棄しますか？      │
├─────────────────────────────────┤
│  入力した内容は保存されません    │
│                                 │
│   [キャンセル]    [破棄する]    │
└─────────────────────────────────┘
```

## API連携

| タイミング | API | 説明 |
|:---|:---|:---|
| 店舗検索時 | Google Places API | 店舗候補取得 |
| 写真追加時 | GET /s3-upload-url | 署名付きURL取得 |
| 写真追加時 | PUT S3 URL | 画像アップロード |
| 保存時 | POST /records | 記録データ保存 |

## 保存フロー

```
[保存ボタンタップ]
      │
      ▼
[バリデーション]
      │
      ├─ 失敗 → [エラー表示]
      │
      ▼ 成功
[写真があれば]
      │
      ├─ あり → [署名付きURL取得] → [S3アップロード]
      │                                    │
      │                                    ▼
      └─ なし ─────────────────→ [POST /records]
                                          │
                                          ▼
                                  [成功: 前画面に戻る]
                                  [失敗: エラー表示]
```

## 遷移先

| アクション | 遷移先 |
|:---|:---|
| 保存成功 | 前画面（SCR-003 or SCR-004） |
| 閉じる | 前画面（確認ダイアログ後） |
